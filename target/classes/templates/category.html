<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<title>Category</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script th:inline="javascript">
		function editCategory(cid) {
            const currentName = document.querySelector(`#category-name-${cid}`).textContent;
		    // 수정할 카테고리명 입력 받기
		    const newName = prompt("새 카테고리명을 입력하세요:", currentName);
		
			// 사용자가 취소
		    if (newName === null) {
		        return;  
		    }
		
		    // 빈 값으로 확인을 눌렀을 경우
		    if (newName.trim() === "") {
		        alert("카테고리명은 빈 칸일 수 없습니다.");
		        return;
		    }
		
		    // PUT 요청으로 데이터 전송
		    axios.put(`/api/admin/category/${cid}`, `cname=${newName}`)
		        .then(function(response) {
		            alert("카테고리가 수정되었습니다.");
		            location.reload(); // 수정 후 새로고침
		        })
		        .catch(function(error) {
		            console.error("수정 실패:", error);
		            alert("카테고리 수정에 실패했습니다.");
		        });
        }

        // 삭제 함수
        function deleteCategory(cid) {
            if (!confirm("정말 삭제하시겠습니까?")) {
                return;
            }
            axios.delete(`/api/admin/category/${cid}`)
            .then(function(response) {
                alert("카테고리가 삭제되었습니다.");
                location.reload(); // 새로고침
            })
            .catch(function(error) {
                console.error("삭제 실패:", error);
                alert("카테고리 삭제에 실패했습니다.");
            });
        }

        // 카테고리 추가 함수
        function addCategory() {
            const newCategory = prompt("새 카테고리명을 입력하세요:");

		    if (!newCategory || newCategory.trim() === "") {
		        alert("카테고리명은 필수입니다.");
		        return;
		    }
		
		    // POST 요청으로 데이터 전송
		    axios.post("/api/admin/category", `cname=${newCategory}`)
		        .then(function(response) {
		            alert("새 카테고리가 추가되었습니다.");
		            location.reload(); // 새로고침
		        })
		        .catch(function(error) {
		            console.error("추가 실패:", error);
		            alert("카테고리 추가에 실패했습니다.");
		        });
        }
    </script>

</head>
<body>
	카테고리 목록
    <div class="row">
        <table class="table" id="category-table">
            <thead>
                <tr>
                    <th class="category col-2"><a>카테고리명</a></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="category : ${categories}">
                    <td class="name" id="category-cell-${category.id}">
					    <span th:id="'category-name-' + ${category.id}" th:text="${category.name}">카테고리명</span>
					</td>
					<td class="edit">
					    <button id="edit" th:onclick="|editCategory(${category.id})|">수정</button>
					</td>
					<td class="delete">
					    <button class="delete-btn" th:onclick="|deleteCategory(${category.id})|">삭제</button>
					</td>
                </tr>
            </tbody>
        </table>
        <div class="add-category-btn">
            <button onclick="addCategory()">새 카테고리 추가</button>
        </div>
    </div>
   
	<style>
        /* .table-container의 크기를 테이블 내용에 맞게 설정 */
        .table-container {
            width: 100%;  /* 테이블 너비를 전체 화면 너비에 맞추거나 필요에 따라 조정 */
            display: flex;
            flex-direction: column;
            align-items: center;  /* 가운데 정렬 */
        }

        table {
            width: 100%;  /* 테이블 너비가 부모의 100%에 맞춰짐 */
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f4f4f4;
        }

        /* 추가 버튼의 위치를 테이블 바로 아래에 가운데 정렬 */
        .add-category-btn {
            margin-top: 20px;
            text-align: center;  /* 버튼을 가운데 정렬 */
        }

        .add-category-btn button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }

        .add-category-btn button:hover {
            background-color: #0056b3;
        }
    </style>
</body>
</html>
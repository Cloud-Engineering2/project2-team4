<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ê²Œì‹œê¸€ ëª©ë¡</title>
<script>
    async function fetchPosts() {
        try {
            let response = await fetch("/api/post");

            if (!response.ok) {
                throw new Error("ì„œë²„ ì˜¤ë¥˜: " + response.status);
            }

            let posts = await response.json();
            console.log("ğŸ“Œ ë¶ˆëŸ¬ì˜¨ ê²Œì‹œê¸€:", posts);

            let tableBody = document.getElementById("postTableBody");
            tableBody.innerHTML = ""; // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”

            posts.forEach(post => {
                let row = document.createElement("tr");

                row.innerHTML = `
                    <td>${post.id || "-"}</td>
                    <td>${post.user?.nickname || "ìµëª…"}</td>
                    <td>${post.category?.name || "ì—†ìŒ"}</td>
                    <td>${post.title}</td>
                    <td>${post.content}</td>
                    <td>${post.link ? `<a href="${post.link}" target="_blank">${post.link}</a>` : "-"}</td>
                    <td>${post.imageUrl ? `<img src="${post.imageUrl}" alt="ì´ë¯¸ì§€" width="50" height="50">` : "-"}</td>
                    <td>${post.likes || 0}</td>
                    <td>${post.createdAt || "-"}</td>
                    <td><button onclick="deletePost(${post.id})">ì‚­ì œ</button></td>
                `;

                tableBody.appendChild(row);
            });

        } catch (error) {
            console.error("âŒ ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
            alert("âŒ ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤!");
        }
    }

    async function deletePost(postId) {
        if (!confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            return;
        }

        try {
            let response = await fetch(`/api/post/${postId}`, {
                method: "DELETE",
            });

            if (!response.ok) {
                throw new Error("ì‚­ì œ ì‹¤íŒ¨: " + response.status);
            }

            alert("âœ… ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
            fetchPosts(); // ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        } catch (error) {
            console.error("âŒ ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨:", error);
            alert("âŒ ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤!");
        }
    }
</script>

</head>
<body>
	<h2>ê²Œì‹œê¸€ ëª©ë¡</h2>
	<button onclick="fetchPosts()">ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸°</button>

	<table border="1">
		<thead>
			<tr>
				<th>ID</th>
				<th>ì‘ì„±ì</th>
				<th>ì¹´í…Œê³ ë¦¬</th>
				<th>ì œëª©</th>
				<th>ë‚´ìš©</th>
				<th>ë§í¬</th>
				<th>ì´ë¯¸ì§€</th>
				<th>ì¢‹ì•„ìš”</th>
				<th>ì‘ì„±ì¼</th>
			</tr>
		</thead>
		<tbody id="postTableBody">
			<!-- JavaScriptë¡œ ë°ì´í„° ì‚½ì… -->
		</tbody>
	</table>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</title>
    <script>
    async function uploadFile() {
        let formData = new FormData();

        // ì…ë ¥ í•„ë“œ ê°€ì ¸ì˜¤ê¸°
        let fileInput = document.getElementById("file");
        let titleInput = document.getElementById("title");
        let contentInput = document.getElementById("content");

        let file = fileInput.files[0];
        let title = titleInput.value.trim();
        let content = contentInput.value.trim();

        // í•„ìˆ˜ê°’ ì²´í¬
        if (!file) {
            alert("ğŸ“Œ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤!");
            return;
        }
        if (!title) {
            alert("ğŸ“Œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!");
            titleInput.focus();
            return;
        }
        if (!content) {
            alert("ğŸ“Œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!");
            contentInput.focus();
            return;
        }

        // JSON ë°ì´í„° ìƒì„±
        let postData = {
            user: { id: 1 },
            category: { id: 1 },
            title: title,
            content: content,
            link: document.getElementById("link").value.trim()
        };

        // FormDataì— ì¶”ê°€
        formData.append("file", file);
        formData.append("post", new Blob([JSON.stringify(postData)], { type: "application/json" }));

        try {
            console.log("ğŸ“Œ ì „ì†¡í•  ë°ì´í„°:", postData);

            let response = await fetch("/api/post", {
                method: "POST",
                body: formData
            });

            let responseText = await response.text();
            console.log("ğŸ“Œ ì„œë²„ ì‘ë‹µ:", responseText);

            if (!response.ok) {
                throw new Error("ì„œë²„ ì˜¤ë¥˜: " + response.status);
            }

            try {
                let jsonData = JSON.parse(responseText);
                alert("âœ… ì—…ë¡œë“œ ì„±ê³µ! ê²Œì‹œê¸€ ID: " + jsonData.id);
            } catch (error) {
                console.error("ğŸ“Œ JSON íŒŒì‹± ì‹¤íŒ¨:", error);
                alert("âš  ì„œë²„ ì‘ë‹µì´ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. ì‘ë‹µ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.");
            }

        } catch (error) {
            console.error("âŒ ì—…ë¡œë“œ ì‹¤íŒ¨:", error);
            alert("âŒ ì—…ë¡œë“œ ì‹¤íŒ¨! " + error.message);
        }
    }

    </script>
</head>
<body>
    <h2>íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
    
    <label for="title">ì œëª©:</label>
    <input type="text" id="title"><br>

    <label for="content">ë‚´ìš©:</label>
    <textarea id="content"></textarea><br>

    <label for="link">ë§í¬:</label>
    <input type="text" id="link"><br>

    <label for="file">íŒŒì¼ ì—…ë¡œë“œ:</label>
    <input type="file" id="file"><br>

    <button onclick="uploadFile()">ì „ì†¡</button>
</body>
</html>
